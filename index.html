<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø§Ø²ÛŒ Ú†ÛŒØ³ØªØ§Ù† - Ø­Ø§Ù„Øª Ø±Ú©ÙˆØ±Ø¯ÛŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles - Existing */
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            overscroll-behavior: none;
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ and Edge */
            user-select: none; /* Standard syntax */
        }
        .gold-gradient-text {
            background: linear-gradient(90deg, #FFD700, #F0C040, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .btn-golden {
            background: linear-gradient(145deg, #c39d1a, #e6c229, #c39d1a);
            color: #121212;
            font-weight: bold;
            border-radius: 12px;
            padding: 12px 24px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
        }
        .btn-golden:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }
        .btn-golden:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
        }
        .btn-golden.disabled {
            background: linear-gradient(145deg, #5c5c5c, #7a7a7a, #5c5c5c);
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
            border-color: #666;
        }
        .btn-golden.disabled:hover { transform: none; box-shadow: none; }
        .card {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 16px;
        }
        .split-circle {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(to right, #121212 50%, #FFD700 50%);
            border: 2px solid #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        #falling-letters-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.15;
        }
        .btn-option {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #E0E0E0;
            padding: 12px;
            border-radius: 10px;
            transition: all 0.2s ease;
            width: 100%;
        }
        .btn-option:hover:not(:disabled) {
            background-color: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;
        }
        .btn-option:disabled { cursor: not-allowed; }
        .modal { transition: opacity 0.3s ease, visibility 0.3s ease; }
        .timer-flash { animation: pulse 1s infinite; }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        #creators-content {
            transform: translateY(-100vh);
            text-align: center;
            white-space: nowrap;
            animation: creditRoll 20s linear forwards;
            animation-play-state: paused;
            will-change: transform;
        }
        #creators-screen.active #creators-content { animation-play-state: running; }
        @keyframes creditRoll {
            0% { transform: translateY(-100vh); }
            100% { transform: translateY(100vh); }
        }
        .credit-item { margin-bottom: 24px; padding: 8px 0; color: #E0E0E0; }
        .credit-role { font-size: 1.5rem; font-weight: 700; text-shadow: 0 0 5px rgba(255, 215, 0, 0.4); margin-bottom: 4px; }
        .credit-name { font-size: 2.25rem; font-weight: 900; line-height: 1.2; }

        .soon-modal-panel {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            opacity: 0;
            transform: scale(0.8) translateY(20px);
        }
        .soon-modal.active .soon-modal-panel {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        .soon-modal {
            transition: background-color 0.5s ease;
        }
        .soon-text {
            animation: bounceIn 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) both;
            display: inline-block;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="overflow-hidden">
    
    <!-- Main Menu Screen -->
    <div id="main-menu-screen" class="screen p-6 flex flex-col h-screen">
        <canvas id="falling-letters-canvas"></canvas>
        <!-- HEADER - EDITED -->
        <header class="flex justify-between items-center mb-16">
            <div class="flex items-center space-x-4 space-x-reverse">
                <div class="split-circle"></div>
                <div>
                    <p id="menu-username" class="font-bold text-lg text-white"></p>
                    <p id="menu-highscore" class="text-sm gold-gradient-text font-bold">ğŸš€ Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯: 0</p>
                </div>
            </div>
            <div class="flex items-center space-x-4 space-x-reverse">
                <!-- NEW News Button -->
                <button id="header-news-btn" class="relative text-gray-300 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    <span id="news-badge" class="absolute top-0 right-0 transform translate-x-1/3 -translate-y-1/3 flex items-center justify-center w-5 h-5 bg-red-600 text-white text-xs font-bold rounded-full border-2 border-gray-900">1</span>
                </button>
                <button id="settings-btn" class="text-3xl">âš™ï¸</button>
            </div>
        </header>

        <main class="flex-grow flex flex-col justify-center items-center space-y-4">
            <button id="start-game-btn" class="w-full max-w-[280px] btn-golden text-xl py-3">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
            <button class="w-full max-w-[280px] btn-golden disabled text-xl py-3">
                Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† <span class="text-xs">(Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ)</span>
            </button>
        </main>

        <footer class="w-full max-w-sm mx-auto pb-2 px-2">
            <div class="bg-black/30 backdrop-blur-sm border border-yellow-400/20 rounded-2xl grid grid-cols-3 gap-2 text-center p-2">
                <button id="nav-ways-btn" class="flex flex-col items-center justify-center text-gray-400 p-2 rounded-lg hover:bg-yellow-400/10 transition-colors text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14 10l-2 1m0 0l-2-1m2 1v10m-6 3h12a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v7a2 2 0 002 2z"/></svg>
                    <span>Ø±Ø§Ù‡ Ù‡Ø§</span>
                </button>
                <button id="nav-challenges-btn" class="flex flex-col items-center justify-center text-gray-400 p-2 rounded-lg hover:bg-yellow-400/10 transition-colors text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.539 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.539-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>
                    <span>Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§</span>
                </button>
                <button id="nav-history-btn" class="flex flex-col items-center justify-center text-gray-400 p-2 rounded-lg hover:bg-yellow-400/10 transition-colors text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span>ØªØ§Ø±ÛŒØ®Ú†Ù‡</span>
                </button>
            </div>
        </footer>
    </div>
    
    <!-- Game Mode Selection Modal -->
    <div id="mode-selection-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
        <div class="card p-8 rounded-lg w-11/12 max-w-md text-center space-y-6">
            <h2 class="text-3xl font-bold gold-gradient-text mb-6">Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø§Ù„Øª Ø¨Ø§Ø²ÛŒ</h2>
            <button onclick="selectGameMode('old')" class="w-full btn-golden text-xl py-4 flex flex-col items-center">
                <span class="text-2xl font-black">2 Old (Ú©Ù„Ø§Ø³ÛŒÚ©)</span>
                <span class="text-sm font-normal mt-1 text-gray-900">Ú†Ù†Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒØŒ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø²Ù…Ø§Ù†ÛŒ</span>
            </button>
            <button onclick="selectGameMode('flash')" class="w-full btn-golden text-xl py-4 flex flex-col items-center">
                <span class="text-2xl font-black">2.5 Flash</span>
                <span class="text-sm font-normal mt-1 text-gray-900">Ø³ÙˆØ§Ù„Ø§Øª Ø³Ø®ØªØŒ ØªØ§ÛŒÙ¾ Ù¾Ø§Ø³Ø®ØŒ Ø²Ù…Ø§Ù† Ù…Ø­Ø¯ÙˆØ¯</span>
            </button>
            <button id="close-mode-selection-btn" class="mt-4 w-full p-3 bg-gray-700 rounded-lg text-white hover:bg-gray-600 transition-colors">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <!-- Settings Modal - EDITED -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
        <div class="card p-8 rounded-lg w-11/12 max-w-md text-center space-y-4">
            <h2 class="text-2xl font-bold gold-gradient-text mb-6">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
            <button id="creators-btn" class="w-full p-3 bg-gray-700 rounded-lg hover:bg-yellow-400/20 transition-colors">Ø³Ø§Ø²Ù†Ø¯Ú¯Ø§Ù†</button>
            <!-- News button removed from here -->
            <button id="close-settings-btn" class="mt-6 w-full btn-golden">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>

    <!-- Coming Soon Modal -->
    <div id="soon-modal" class="soon-modal hidden fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50">
        <div id="soon-modal-panel" class="soon-modal-panel card p-8 rounded-2xl w-11/12 max-w-md text-center space-y-6">
            <h2 class="text-6xl font-black gold-gradient-text soon-text">âœ¨ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ âœ¨</h2>
            <p class="text-xl text-gray-300">Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù‡ÛŒØ¬Ø§Ù†â€ŒØ§Ù†Ú¯ÛŒØ² Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª Ùˆ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯!</p>
            <div class="mt-8">
                <button id="close-soon-modal-btn" class="w-full btn-golden text-xl py-3">ÙÙ‡Ù…ÛŒØ¯Ù…</button>
            </div>
        </div>
    </div>

    <!-- Creators Screen (Credit Roll) -->
    <div id="creators-screen" class="screen fixed inset-0 bg-black/95 flex flex-col items-center z-50">
        <header class="relative w-full text-center py-6 bg-black/50">
            <h1 class="text-3xl font-black gold-gradient-text">Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª Ø³Ø§Ø²Ù†Ø¯Ú¯Ø§Ù†</h1>
            <button id="back-from-creators-btn" class="absolute top-1/2 -translate-y-1/2 right-4 text-3xl text-white">â¡ï¸</button>
        </header>
        <div class="flex-grow w-full overflow-hidden relative">
            <div id="creators-content" class="absolute w-full top-0">
                <div class="credit-item"><p class="credit-role gold-gradient-text">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ Ø§Ø±Ø´Ø¯ Ùˆ Ø·Ø±Ø§Ø­</p><p class="credit-name">Ø¹Ù„ÛŒ Ø¨Ø§Ø¨Ø§ÛŒÛŒ</p></div>
                <div class="credit-item mt-20"><p class="credit-role gold-gradient-text">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ Ø³Ø±ÙˆØ± Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ Ø¯ÙˆÙ…</p><p class="credit-name">Ø³ÛŒØ¯ Ø§Ø¨ÙˆÙ„ÙØ¶Ù„ Ø³Ø¬Ø§Ø¯ÛŒ</p></div>
                <div class="credit-item mt-20 text-4xl font-bold"><p class="gold-gradient-text">Ø§Ø³Ú©ÙˆØ±Øª Ú¯ÛŒÙ…</p><p class="text-gray-400 text-xl mt-4">ØªÙ‚Ø¯ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯</p></div>
                <div style="height: 50vh;"></div> 
            </div>
        </div>
    </div>
    
    <!-- Gameplay Screen -->
    <div id="gameplay-screen" class="screen p-6 flex flex-col h-screen">
        <header class="flex items-center justify-between mb-8">
            <div class="flex items-center space-x-2 space-x-reverse"><p class="text-red-400 text-3xl">â¤ï¸</p><p id="lives-count" class="text-2xl font-bold text-white">3</p></div>
            <div id="timer-display" class="hidden text-center card px-4 py-2 rounded-lg bg-red-900/50 border-red-500/50"><p class="text-lg font-bold">Ø²Ù…Ø§Ù†:</p><p id="timer-count" class="text-3xl font-black text-red-400">15</p></div>
            <div class="text-center"><p class="text-2xl font-bold gold-gradient-text">Ø§Ù…ØªÛŒØ§Ø²: <span id="game-score">0</span></p></div>
        </header>
        <main class="flex-grow flex flex-col justify-center items-center text-center">
            <div class="w-full max-w-lg card p-8">
                <p id="riddle-question" class="text-xl md:text-2xl mb-8 min-h-[100px] flex items-center justify-center"></p>
                <div id="options-container" class="grid grid-cols-2 gap-4"></div>
                <div id="input-container" class="hidden flex flex-col gap-4 w-full">
                    <input type="text" id="flash-answer-input" placeholder="Ù¾Ø§Ø³Ø® Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯..." class="w-full p-4 bg-gray-800 border border-yellow-400/50 rounded-lg text-white text-center focus:outline-none focus:ring-2 focus:ring-yellow-400 transition-colors text-lg" style="caret-color: #FFD700;">
                    <button id="flash-submit-btn" class="w-full btn-golden text-xl py-3">Ø«Ø¨Øª Ù¾Ø§Ø³Ø®</button>
                </div>
            </div>
            <!-- *** NEW HINT BUTTONS *** -->
            <div id="hint-container" class="mt-6 flex justify-center space-x-4 space-x-reverse w-full max-w-lg">
                <button id="indirect-hint-btn" class="btn-golden text-sm py-2 px-4 w-1/2">ğŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ</button>
                <button id="direct-hint-btn" class="btn-golden text-sm py-2 px-4 w-1/2">ğŸ”‘ Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„</button>
            </div>
        </main>
    </div>
    
    <!-- Game Over Screen -->
    <div id="game-over-screen" class="screen p-8 flex flex-col justify-center items-center text-center h-screen">
        <div class="card p-8 rounded-lg w-11/12 max-w-md space-y-6">
            <h2 class="text-4xl font-black text-red-400">Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯!</h2>
            <div>
                <p class="text-xl">Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: <span id="final-score" class="text-yellow-400 font-bold"></span></p>
                <p class="text-lg mt-2">Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯: <span id="final-highscore" class="text-gray-300 font-bold"></span></p>
            </div>
            <div class="flex space-x-4 space-x-reverse">
                <button id="play-again-btn" class="w-full btn-golden">Ø¨Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯</button>
                <button id="back-to-menu-gameover-btn" class="w-full p-3 bg-gray-700 rounded-lg">Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</button>
            </div>
        </div>
    </div>

    <!-- News Screen -->
    <div id="news-screen" class="screen p-6 flex flex-col justify-center items-center h-screen">
        <div class="card p-8 rounded-lg w-11/12 max-w-md space-y-6 text-center">
            <h2 class="text-3xl font-black gold-gradient-text">ğŸ“¢ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ "Ø³Ø§Ø±ÛŒÙ†Ø§"</h2>
            <div class="text-lg text-right leading-relaxed text-gray-300 space-y-4">
                <p>Ø³Ù„Ø§Ù… Ø¨Ù‡ Ù‡Ù…Ù‡ Ú†ÛŒØ³ØªØ§Ù†â€ŒØ¨Ø§Ø²Ù‡Ø§ÛŒ Ø¹Ø²ÛŒØ²!</p>
                <p>Ø¨Ø§ Ù‡ÛŒØ¬Ø§Ù† ÙØ±Ø§ÙˆØ§Ù†ØŒ Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø²Ø±Ú¯ Ø¨Ø¹Ø¯ÛŒ Ø¨Ø§ Ø§Ø³Ù… Ø±Ù…Ø² <strong class="text-yellow-400">"Ø³Ø§Ø±ÛŒÙ†Ø§"</strong> Ø±Ø§ Ù…Ø¹Ø±ÙÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…! Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù„ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙÙ† Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯:</p>
                <ul class="list-disc list-inside mt-2 space-y-2 pr-4">
                    <li>âš”ï¸ <strong>Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†:</strong> Ø¯ÙˆØ³ØªØ§Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ú†Ø§Ù„Ø´ Ø¨Ú©Ø´ÛŒØ¯!</li>
                    <li>ğŸ‘• <strong>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ùˆ Ø¢ÙˆØ§ØªØ§Ø±:</strong> Ø´Ø®ØµÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ú©Ù†ÛŒØ¯!</li>
                    <li>ğŸ Ùˆ Ú©Ù„ÛŒ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù‡ÛŒØ¬Ø§Ù†â€ŒØ§Ù†Ú¯ÛŒØ² Ø¯ÛŒÚ¯Ø±...</li>
                </ul>
                <p class="text-center pt-4">Ù…Ù†ØªØ¸Ø± Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø´ÛŒØ¯!</p>
            </div>
            <button id="back-from-news-btn" class="w-full btn-golden mt-6">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
        </div>
    </div>


    <script>
        // --- DOM Elements ---
        const screens = {
            mainMenu: document.getElementById('main-menu-screen'),
            gameplay: document.getElementById('gameplay-screen'),
            gameOver: document.getElementById('game-over-screen'),
            creators: document.getElementById('creators-screen'),
            news: document.getElementById('news-screen'),
        };
        const settingsModal = document.getElementById('settings-modal');
        const modeSelectionModal = document.getElementById('mode-selection-modal');
        const soonModal = document.getElementById('soon-modal');
        const soonModalPanel = document.getElementById('soon-modal-panel');
        const timerDisplay = document.getElementById('timer-display');
        const timerCount = document.getElementById('timer-count');
        const inputContainer = document.getElementById('input-container');
        const optionsContainer = document.getElementById('options-container');
        // *** NEW: Hint Buttons ***
        const indirectHintBtn = document.getElementById('indirect-hint-btn');
        const directHintBtn = document.getElementById('direct-hint-btn');


        // --- Game State & Data ---
        const FLASH_TIME_LIMIT = 15;
        const STARTING_LIVES = 3;
        const STORAGE_KEY = 'chistanRecordGameState';
        // *** NEW: Added hint usage state ***
        let gameState = { 
            username: 'Ù‡ÙˆØ´ÛŒØ§Ø±', 
            highScore: 0, 
            score: 0, 
            lives: STARTING_LIVES, 
            currentMode: 'old', 
            usedRiddleIndices: [],
            indirectHintUsed: false,
            directHintUsed: false
        };
        let gameTimer;

        // --- Riddles with Hints ---
        const allRiddles = [
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ù¾Ø± Ø¯Ø§Ø±Ø¯ ÙˆÙ„ÛŒ Ù¾Ø±ÙˆØ§Ø² Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ', a: 'Ø¨Ø§Ù„Ø´', options: ['Ù¾Ø±Ù†Ø¯Ù‡', 'Ø¨Ø§Ù„Ø´', 'Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§', 'Ø¨Ø§Ø¯Ø¨Ø§Ø¯Ú©'], indirectHint: 'Ø´Ø¨â€ŒÙ‡Ø§ Ø³Ø±Øª Ø±Ø§ Ø±ÙˆÛŒ Ø¢Ù† Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±ÛŒ.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ø¨Ø§Ù„Ø´' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ù‡Ø±Ú†Ù‡ Ø§Ø² Ø¢Ù† Ø¨Ø±Ø¯Ø§Ø±Ù†Ø¯ Ø¨Ø²Ø±Ú¯ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ', a: 'Ú¯ÙˆØ¯Ø§Ù„', options: ['Ú©ÛŒØ³Ù‡', 'Ú©ÙˆÙ‡', 'Ú¯ÙˆØ¯Ø§Ù„', 'Ø¯Ø±Ø®Øª'], indirectHint: 'Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®ØªÙ† Ø¢Ù† Ø¨Ø§ÛŒØ¯ Ø®Ø§Ú© Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø´Øª.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ú¯ÙˆØ¯Ø§Ù„' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ ÛŒÚ© Ú†Ø´Ù… Ø¯Ø§Ø±Ø¯ ÙˆÙ„ÛŒ Ù†Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ø¯ØŸ', a: 'Ø³ÙˆØ²Ù†', options: ['Ø³ÙˆØ²Ù†', 'Ø³ÛŒÚ©Ù„ÙˆÙ¾', 'Ø¯ÙˆØ±Ø¨ÛŒÙ†', 'Ù‡ÛŒÙˆÙ„Ø§'], indirectHint: 'Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ®Øª Ùˆ Ø¯ÙˆØ² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ø³ÙˆØ²Ù†' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ú¯Ø±Ø¯Ù† Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ø³Ø± Ù†Ø¯Ø§Ø±Ø¯ØŸ', a: 'Ú©ÙˆØ²Ù‡', options: ['Ù¾ÛŒØ±Ø§Ù‡Ù†', 'Ø¨Ø·Ø±ÛŒ', 'Ú©ÙˆØ²Ù‡', 'Ø´ÛŒØ´Ù‡'], indirectHint: 'Ø¯Ø± Ù‚Ø¯ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø¢Ø¨ Ø§Ø² Ø¢Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ø±Ø¯Ù†Ø¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ú©ÙˆØ²Ù‡' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ø±ÙˆØ² Ø±Ø§ Ø¢ØºØ§Ø² Ùˆ Ø´Ø¨ Ø±Ø§ ØªÙ…Ø§Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ', a: 'Ø±', options: ['Ø¢ÙØªØ§Ø¨', 'Ù…Ø§Ù‡', 'Ø±', 'Ø´'], indirectHint: 'ÛŒÚ© Ø­Ø±Ù Ø§Ø² Ø§Ù„ÙØ¨Ø§ Ø§Ø³Øª.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ø­Ø±Ù "Ø±"' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ù‡Ù…Ù‡ Ø¬Ø§ Ù‡Ø³Øª ÙˆÙ„ÛŒ Ø¯ÛŒØ¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ', a: 'Ù‡ÙˆØ§', options: ['ØµØ¯Ø§', 'Ù‡ÙˆØ§', 'ÙÚ©Ø±', 'Ø¹Ø´Ù‚'], indirectHint: 'Ø¨Ø±Ø§ÛŒ Ù†ÙØ³ Ú©Ø´ÛŒØ¯Ù† Ø¨Ù‡ Ø¢Ù† Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒÙ….', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ù‡ÙˆØ§' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ø²Ø¨Ø§Ù† Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ø³Ø®Ù† Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯ØŸ', a: 'Ú©ØªØ§Ø¨', options: ['Ø±Ø§Ø¯ÛŒÙˆ', 'Ù‚Ù„Ù…', 'Ú©ØªØ§Ø¨', 'Ù†Ø§Ù…Ù‡'], indirectHint: 'Ø¯ÙˆØ³ØªÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§ ØªÙˆ Ø­Ø±Ù Ù…ÛŒâ€ŒØ²Ù†Ø¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ú©ØªØ§Ø¨' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ù¾Ø§ Ù†Ø¯Ø§Ø±Ø¯ ÙˆÙ„ÛŒ Ø³ÙØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ', a: 'Ù†Ø§Ù…Ù‡', options: ['Ø§Ø¨Ø±', 'Ø¯ÙˆØ¯', 'Ø±ÙˆØ¯Ø®Ø§Ù†Ù‡', 'Ù†Ø§Ù…Ù‡'], indirectHint: 'Ø¯Ø± Ú¯Ø°Ø´ØªÙ‡ ØªÙˆØ³Ø· Ù¾Ø³ØªÚ†ÛŒ Ø­Ù…Ù„ Ù…ÛŒâ€ŒØ´Ø¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ù†Ø§Ù…Ù‡' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø¯Ù† Ø§Ø³Øª ÙˆÙ„ÛŒ Ù‡Ø±Ú¯Ø² Ù†Ù…ÛŒâ€ŒØ±Ø³Ø¯ØŸ', a: 'ÙØ±Ø¯Ø§', options: ['Ù‚Ø·Ø§Ø±', 'ÙØ±Ø¯Ø§', 'Ù…Ø±Ú¯', 'Ø®ÙˆØ§Ø¨'], indirectHint: 'Ú†ÛŒØ²ÛŒ Ú©Ù‡ Ù‡Ù…ÛŒØ´Ù‡ ÛŒÚ© Ø±ÙˆØ² Ø¨Ø§ Ù…Ø§ ÙØ§ØµÙ„Ù‡ Ø¯Ø§Ø±Ø¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: ÙØ±Ø¯Ø§' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ø¯Ø± Ø²Ù…Ø³ØªØ§Ù† Ù…ÛŒâ€ŒØ§ÛŒØ³ØªØ¯ Ùˆ Ø¯Ø± ØªØ§Ø¨Ø³ØªØ§Ù† Ù…ÛŒâ€ŒÙ†Ø´ÛŒÙ†Ø¯ØŸ', a: 'Ø¨Ø±Ù', options: ['Ø¢Ø¯Ù… Ø¨Ø±ÙÛŒ', 'Ú©ÙˆÙ‡', 'ÛŒØ®', 'Ø¨Ø±Ù'], indirectHint: 'Ø³ÙÛŒØ¯ Ø§Ø³Øª Ùˆ Ø§Ø² Ø¢Ø³Ù…Ø§Ù† Ù…ÛŒâ€ŒØ¨Ø§Ø±Ø¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ø¨Ø±Ù' },
        ];
        const hardRiddles = [
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ ÙˆÙ‚ØªÛŒ Ø§ÛŒØ³ØªØ§Ø¯Ù‡ Ø§Ø³Øª Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¨Ø¯ Ùˆ ÙˆÙ‚ØªÛŒ Ø±Ø§Ù‡ Ù…ÛŒâ€ŒØ±ÙˆØ¯ Ø¨ÛŒØ¯Ø§Ø± Ø§Ø³ØªØŸ', a: 'Ù‚Ø·Ø§Ø±', options: [], indirectHint: 'Ø±ÙˆÛŒ Ø±ÛŒÙ„ Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ù‚Ø·Ø§Ø±' },
            { q: 'Ù…Ù† Ù‡ÛŒÚ† Ø¨Ø¯Ù†ÛŒ Ù†Ø¯Ø§Ø±Ù… Ø§Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø±Ø§Ù‡ Ø¨Ø±ÙˆÙ…. Ù…Ù† Ø¯Ù‡Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ù… Ø§Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø­Ø±Ù Ø¨Ø²Ù†Ù…. Ù…Ù† Ú©ÛŒØ³ØªÙ…ØŸ', a: 'Ù¾Ú˜ÙˆØ§Ú©', options: [], indirectHint: 'ØªÚ©Ø±Ø§Ø± ØµØ¯Ø§ Ø§Ø³Øª.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ù¾Ú˜ÙˆØ§Ú©' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ø§Ú¯Ø± Ø¢Ù† Ø±Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±ÛŒØŒ Ùˆ Ø§Ú¯Ø± Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±ÛŒ Ø¯ÛŒÚ¯Ø± Ø¢Ù† Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØŸ', a: 'Ø±Ø§Ø²', options: [], indirectHint: 'Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ú©Ø³ÛŒ Ú¯ÙØªÙ‡ Ø´ÙˆØ¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ø±Ø§Ø²' },
            { q: 'Ú†Ù‡ Ú†ÛŒØ²ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø¬Ù„ÙˆØªØ± Ø§Ø² Ø´Ù…Ø§Ø³Øª Ø§Ù…Ø§ Ù‡Ø±Ú¯Ø² Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø¨Ú¯ÛŒØ±ÛŒØ¯ØŸ', a: 'Ø¢ÛŒÙ†Ø¯Ù‡', options: [], indirectHint: 'Ù†Ù‚Ø·Ù‡â€ŒÛŒ Ù…Ù‚Ø§Ø¨Ù„ Ú¯Ø°Ø´ØªÙ‡ Ø§Ø³Øª.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ø¢ÛŒÙ†Ø¯Ù‡' },
            { q: 'Ø¢Ù† Ú†ÛŒØ³Øª Ú©Ù‡ Ø¨Ø¯ÙˆÙ† Ú©Ù„ÛŒØ¯ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ', a: 'Ù…ÙˆØ²', options: [], indirectHint: 'ÛŒÚ© Ù†ÙˆØ¹ Ù…ÛŒÙˆÙ‡ Ø§Ø³Øª.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ù…ÙˆØ²' },
            { q: 'Ú†Ù‡Ø§Ø±Ù¾Ø§ Ø¯Ø§Ø±Ù… Ø§Ù…Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ø¯ÙˆÙ…ØŒ Ù¾Ø´Øª Ø¯Ø§Ø±Ù… Ø§Ù…Ø§ Ú©Ù…Ø± Ù†Ø¯Ø§Ø±Ù…. Ù…Ù† Ú©ÛŒØ³ØªÙ…ØŸ', a: 'Ù…ÛŒØ²', options: [], indirectHint: 'Ø¯Ø± Ø®Ø§Ù†Ù‡ Ùˆ Ø§Ø¯Ø§Ø±Ù‡ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø±ÙˆÛŒ Ø¢Ù† ÙˆØ³ÛŒÙ„Ù‡ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ù†Ø¯.', directHint: 'Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„: Ù…ÛŒØ²' },
        ];
        
        // --- Helper Functions ---
        function normalizeAnswer(text) { if (typeof text !== 'string') return ''; return text.trim().replace(/ÛŒ/g, 'ÙŠ').replace(/Ú©/g, 'Ùƒ').toLowerCase().replace(/\s/g, ''); }

        // --- Persistence ---
        function saveGameState() { try { const stateToSave = { highScore: gameState.highScore }; localStorage.setItem(STORAGE_KEY, JSON.stringify(stateToSave)); } catch (e) { console.error("Failed to save game state:", e); } }
        function loadGameState() { try { const savedState = localStorage.getItem(STORAGE_KEY); if (savedState) { const loadedState = JSON.parse(savedState); gameState.highScore = loadedState.highScore || 0; } } catch (e) { console.error("Failed to load game state:", e); } }

        // --- Navigation ---
        function showScreen(screenName) {
            if (screens.creators.classList.contains('active')) { screens.creators.classList.remove('active'); }
            Object.values(screens).forEach(screen => screen.style.display = 'none');
            const currentScreen = screens[screenName];
            if (currentScreen) { currentScreen.style.display = 'flex'; }
            if (screenName === 'creators') { initCreatorsScreen(); }
        }

        // --- Coming Soon Modal Logic ---
        function showSoonModal() {
            soonModal.classList.remove('hidden'); soonModal.classList.remove('opacity-0'); soonModalPanel.classList.remove('active');
            setTimeout(() => { soonModal.classList.add('active'); soonModalPanel.classList.add('active'); }, 10);
        }
        function hideSoonModal() {
            soonModalPanel.classList.remove('active'); soonModal.classList.remove('active');
            setTimeout(() => { soonModal.classList.add('hidden'); }, 500); 
        }
        
        // --- UI Update ---
        function updateUI() {
            document.getElementById('menu-username').textContent = gameState.username;
            document.getElementById('menu-highscore').textContent = `ğŸš€ Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯: ${gameState.highScore}`;
            document.getElementById('game-score').textContent = gameState.score;
            document.getElementById('lives-count').textContent = gameState.lives;
        }

        // *** NEW: Update Hint Buttons UI ***
        function updateHintButtonsUI() {
            if (gameState.indirectHintUsed) {
                indirectHintBtn.classList.add('disabled');
                indirectHintBtn.disabled = true;
            } else {
                indirectHintBtn.classList.remove('disabled');
                indirectHintBtn.disabled = false;
            }

            if (gameState.directHintUsed) {
                directHintBtn.classList.add('disabled');
                directHintBtn.disabled = true;
            } else {
                directHintBtn.classList.remove('disabled');
                directHintBtn.disabled = false;
            }
        }
        
        // --- Timer Logic ---
        function startTimer() {
            if (gameState.currentMode !== 'flash') return;
            let timeRemaining = FLASH_TIME_LIMIT;
            timerCount.textContent = timeRemaining;
            timerDisplay.classList.remove('hidden'); timerDisplay.classList.remove('timer-flash');
            clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                timeRemaining--; timerCount.textContent = timeRemaining;
                if (timeRemaining <= 5) { timerDisplay.classList.add('timer-flash'); } else { timerDisplay.classList.remove('timer-flash'); }
                if (timeRemaining <= 0) { clearInterval(gameTimer); checkAnswer(null); }
            }, 1000);
        }
        function stopTimer() { clearInterval(gameTimer); timerDisplay.classList.add('hidden'); timerDisplay.classList.remove('timer-flash'); }

        // --- Game Logic ---
        function selectGameMode(mode) { gameState.currentMode = mode; modeSelectionModal.classList.add('hidden'); startGame(); }
        function startGame() { 
            gameState.score = 0; 
            gameState.lives = STARTING_LIVES; 
            gameState.usedRiddleIndices = []; 
            // *** NEW: Reset hints on new game start ***
            gameState.indirectHintUsed = false;
            gameState.directHintUsed = false;
            updateHintButtonsUI();
            updateUI(); 
            showScreen('gameplay'); 
            loadNextRiddle(); 
        }
        function loadNextRiddle() {
            const riddleSource = gameState.currentMode === 'flash' ? hardRiddles : allRiddles;
            if (gameState.usedRiddleIndices.length === riddleSource.length) { gameState.usedRiddleIndices = []; }
            let riddleIndex;
            do { riddleIndex = Math.floor(Math.random() * riddleSource.length); } while (gameState.usedRiddleIndices.includes(riddleIndex));
            gameState.usedRiddleIndices.push(riddleIndex);
            const riddle = riddleSource[riddleIndex];
            document.getElementById('riddle-question').textContent = riddle.q;
            if (gameState.currentMode === 'flash') {
                optionsContainer.classList.add('hidden'); inputContainer.classList.remove('hidden');
                document.getElementById('flash-answer-input').value = ''; document.getElementById('flash-answer-input').focus();
                startTimer();
            } else {
                inputContainer.classList.add('hidden'); optionsContainer.classList.remove('hidden');
                optionsContainer.innerHTML = '';
                riddle.options.forEach(option => {
                    const button = document.createElement('button'); button.textContent = option; button.className = 'btn-option';
                    button.onclick = () => checkAnswer(option, riddle.a, button);
                    optionsContainer.appendChild(button);
                });
            }
        }
        function checkAnswer(selectedAnswer, correctAnswer, btnElement = null) {
            stopTimer(); let isCorrect = false;
            if (gameState.currentMode === 'flash') {
                const flashInput = document.getElementById('flash-answer-input').value;
                const riddle = hardRiddles[gameState.usedRiddleIndices[gameState.usedRiddleIndices.length - 1]];
                correctAnswer = riddle.a; isCorrect = normalizeAnswer(flashInput) === normalizeAnswer(correctAnswer);
            } else { isCorrect = normalizeAnswer(selectedAnswer) === normalizeAnswer(correctAnswer); }
            optionsContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
            if (isCorrect) {
                gameState.score += 10; if (btnElement) { btnElement.style.backgroundColor = '#2E7D32'; btnElement.style.borderColor = '#4CAF50'; }
            } else {
                gameState.lives--; if (btnElement) { btnElement.style.backgroundColor = '#C62828'; btnElement.style.borderColor = '#F44336'; }
            }
            updateUI();
            if (gameState.lives <= 0) { setTimeout(endGame, 1000); } else { setTimeout(loadNextRiddle, 1000); }
        }
        function endGame() {
            stopTimer(); if (gameState.score > gameState.highScore) { gameState.highScore = gameState.score; saveGameState(); }
            document.getElementById('final-score').textContent = gameState.score;
            document.getElementById('final-highscore').textContent = gameState.highScore;
            showScreen('gameOver');
        }

        // *** NEW: Hint Logic Functions ***
        function showIndirectHint() {
            if (gameState.indirectHintUsed) return; // Do nothing if already used

            const riddleSource = gameState.currentMode === 'flash' ? hardRiddles : allRiddles;
            const currentRiddleIndex = gameState.usedRiddleIndices[gameState.usedRiddleIndices.length - 1];
            const currentRiddle = riddleSource[currentRiddleIndex];

            alert(`Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ: ${currentRiddle.indirectHint}`);
            
            gameState.indirectHintUsed = true;
            updateHintButtonsUI();
        }

        function showDirectHint() {
            if (gameState.directHintUsed) return; // Do nothing if already used

            const riddleSource = gameState.currentMode === 'flash' ? hardRiddles : allRiddles;
            const currentRiddleIndex = gameState.usedRiddleIndices[gameState.usedRiddleIndices.length - 1];
            const currentRiddle = riddleSource[currentRiddleIndex];

            alert(currentRiddle.directHint);
            
            gameState.directHintUsed = true;
            updateHintButtonsUI();
        }

        // --- Creators Screen Logic ---
        function initCreatorsScreen() {
            const content = document.getElementById('creators-content'); screens.creators.classList.add('active');
            const newContent = content.cloneNode(true); content.parentNode.replaceChild(newContent, content);
            newContent.style.animation = 'none';
            setTimeout(() => { newContent.style.animation = ''; screens.creators.classList.add('active'); }, 10);
        }

        // --- Event Listeners - EDITED ---
        function setupEventListeners() {
            // Main Menu
            document.getElementById('start-game-btn').addEventListener('click', () => { modeSelectionModal.classList.remove('hidden'); });
            
            // Header Buttons
            document.getElementById('settings-btn').addEventListener('click', () => { settingsModal.classList.remove('hidden'); });
            document.getElementById('header-news-btn').addEventListener('click', () => {
                showScreen('news');
                document.getElementById('news-badge').style.display = 'none';
            });
            
            // Navigation Buttons
            document.getElementById('nav-ways-btn').addEventListener('click', showSoonModal);
            document.getElementById('nav-challenges-btn').addEventListener('click', showSoonModal);
            document.getElementById('nav-history-btn').addEventListener('click', showSoonModal);
            document.getElementById('close-soon-modal-btn').addEventListener('click', hideSoonModal);
            
            // Modals
            document.getElementById('close-mode-selection-btn').addEventListener('click', () => { modeSelectionModal.classList.add('hidden'); });
            document.getElementById('close-settings-btn').addEventListener('click', () => { settingsModal.classList.add('hidden'); });
            
            // Settings Buttons
            document.getElementById('creators-btn').addEventListener('click', () => { settingsModal.classList.add('hidden'); showScreen('creators'); });

            // Back Buttons
            document.getElementById('back-from-news-btn').addEventListener('click', () => { showScreen('mainMenu'); });
            document.getElementById('back-from-creators-btn').addEventListener('click', () => { showScreen('mainMenu'); });

            // Gameplay & Game Over
            document.getElementById('flash-submit-btn').addEventListener('click', () => checkAnswer());
            document.getElementById('flash-answer-input').addEventListener('keyup', (event) => { if (event.key === 'Enter') { checkAnswer(); } });
            document.getElementById('play-again-btn').addEventListener('click', startGame);
            document.getElementById('back-to-menu-gameover-btn').addEventListener('click', () => showScreen('mainMenu'));

            // *** NEW: Hint Event Listeners ***
            indirectHintBtn.addEventListener('click', showIndirectHint);
            directHintBtn.addEventListener('click', showDirectHint);
        }
        
        // --- Falling Letters Animation ---
        function startFallingLetters() {
            const canvas = document.getElementById('falling-letters-canvas'); if (!canvas) return; const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            const letters = 'Ø§Ø¨Ù¾ØªØ«Ø¬Ú†Ø­Ø®Ø¯Ø°Ø±Ø²Ú˜Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚Ú©Ú¯Ù„Ù…Ù†ÙˆÙ‡ÛŒ'; const fontSize = 18; const columns = canvas.width / fontSize;
            const drops = Array.from({ length: columns }).fill(1);
            function draw() {
                ctx.fillStyle = 'rgba(18, 18, 18, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#FFD700'; ctx.font = `${fontSize}px Vazirmatn`;
                for (let i = 0; i < drops.length; i++) {
                    const text = letters[Math.floor(Math.random() * letters.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) { drops[i] = 0; }
                    drops[i]++;
                }
                if (document.getElementById('main-menu-screen').style.display === 'flex') { requestAnimationFrame(draw); }
            }
            window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
            requestAnimationFrame(draw);
        }

        // --- Initialization ---
        window.onload = function() { loadGameState(); updateUI(); setupEventListeners(); showScreen('mainMenu'); startFallingLetters(); }

    </script>
</body>
</html>
